{% extends "base.html" %}

{% block title %}{{ symbol }} 财报{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">{{ symbol }} 财报</h1>

<h2 class="text-xl font-semibold mt-4">资产负债表</h2>
<div id="balance_sheet"></div>

<h2 class="text-xl font-semibold mt-4">利润表</h2>
<div id="income_statement"></div>

<h2 class="text-xl font-semibold mt-4">现金流表</h2>
<div id="cash_flow"></div>

<script>
// 渲染表格函数
function renderTable(id, data) {
    const header = Object.keys(data[0] || {});
    const values = header.map(h => data.map(r => r[h]));
    const trace = {
        type: 'table',
        header: { values: header, align: "center", fill: {color: "#eee"} },
        cells: { values: values, align: "center" }
    };
    Plotly.newPlot(id, [trace]);
}

// 使用 tojson + safe 渲染 Python 数据到 JS
const balanceSheet = JSON.parse('{{ balance_sheet | tojson | safe }}');
const incomeStatement = JSON.parse('{{ income_statement | tojson | safe }}');
const cashFlow = JSON.parse('{{ cash_flow | tojson | safe }}');

// 渲染表格
renderTable('balance_sheet', balanceSheet);
renderTable('income_statement', incomeStatement);
renderTable('cash_flow', cashFlow);
</script>
{% endblock %}
